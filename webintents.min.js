(function(){var a;window.__WEBINTENTS_DEBUG__?a=__WEBINTENTS_DEBUG__:a="http://webintents.org/";var b=a+"intents.html",c=a+"picker.html",d,e=function(){};e.prototype.startActivity=function(a,b){var d=window.open(c,"_blank","width=300, height=300"),e=new f(a,b);window.addEventListener("message",e.handler,!1)};var f=function(a,b){var c=this;this.handler=function(e){if(e.data.request&&e.data.request=="ready"){var f=new MessageChannel,g,h="intent."+(new Date).valueOf();a._id=h,b&&(g=[f.port2],f.port1.start(),f.port1.addEventListener("message",function(a){b(a.data.intent),f.port1.close(),f.port2.close()}),d.contentWindow.postMessage({request:"registerReturn",intent:a},g,"*")),e.source.postMessage({request:"startActivity",intent:a},[],"*"),window.removeEventListener("message",c.handler,!1)}}};window.addEventListener("load",function(){if(window.opener&&window.opener.closed==!1){var a=new MessageChannel;a.port1.addEventListener("message",function(a){var b=new h;b._id=a.data.intent._id,b.action=a.data.intent.action,b.type=a.data.intent.type,b.data=a.data.intent.data,window.navigator.intents.onActivity&&window.navigator.intents.onActivity(b)},!1),a.port1.start(),a.port2.start(),window.opener.postMessage({request:"launched",name:window.name},[a.port2],"*")}},!1);var g=function(a,b,c,e,f){!!c==!1&&(c=document.location.toString()),c.substring(0,7)!="http://"&&c.substring(0,8)!="https://"&&(c.substring(0,1)=="/"?c=document.location.origin:(path=document.location.href,path=path.substring(0,path.lastIndexOf("/")+1),c=path+c)),d.contentWindow.postMessage({request:"register",intent:{action:a,type:b,url:c,title:e,icon:f}},"*")};e.prototype.register=function(a,b){g(a,b,document.location.href,document.title,i())};var h=function(a,b,c){var e=this;this.action=a,this.type=b,this.data=c,this.postResult=function(a){var b=new h;b._id=e._id,b.action=e.action,b.data=a,d.contentWindow.postMessage({request:"response",intent:b},"*")}},i=function(){var a=document.getElementsByTagName("link"),b;for(var c=0;b=a[c];c++)if(b.rel=="icon")return""},j=function(){var a=document.getElementsByTagName("meta"),b;for(var c=0;b=a[c];c++){var d=b.getAttribute("name");if(d=="intent"){var e=b.getAttribute("title"),f=b.getAttribute("href"),h=b.getAttribute("content"),j=b.getAttribute("type"),k=b.getAttribute("icon")||i();g(h,j,f,e,k)}}},k=function(){var a=document.getElementsByTagName("intent"),b;for(var c=0;b=a[c];c++){var d=b.getAttribute("title"),e=b.getAttribute("href"),f=b.getAttribute("action"),h=b.getAttribute("type"),j=b.getAttribute("icon")||i();g(f,h,e,d,j)}},l=function(){window.Intent=h,window.navigator.intents=new e,!window.postMessage||(d=document.createElement("iframe"),d.style.display="none",d.src=b,d.addEventListener("load",function(){k(),j()},!1),document.body?document.body.appendChild(d):document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(d)},!1)),window.addEventListener("DOMContentReady",function(){var b=new MessageChannel;b.port1.addEventListener("message",function(){},!1),window.postMessage({request:"ready"},[b.port2],a)},!1)};l()})()